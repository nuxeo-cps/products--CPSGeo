<metal:block use-macro="here/main_template/macros/master">
  <metal:block fill-slot="doctype"><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"></metal:block>
  <metal:block fill-slot="javascript_head_slot">
    <script>
	// URL of Mapbuilder configuration file.
    var mbConfigUrl='geo_edit_config.xml';
    
    // Work with the "map_selector" form in the body
    function switch_map()
    {
        var box = document.getElementById("map_selector").map;
        var modelurl = box.options[box.selectedIndex].value;
        if (modelurl) config.loadModel('mainMap', modelurl);
    }

    function submit_location()
    {
        var pos = document.getElementById("doc_location").pos_list.value;
        var field = opener.document.forms[2].widget__pos_list.value = pos;
        window.close();
    }
    </script>
    <script type="text/javascript"
	    tal:attributes="src string:mapbuilder/lib/Mapbuilder.js" />
  </metal:block>
  <metal:block fill-slot="header">
    <h1 i18n:translate="header_geolocation_form">
	Geo-locate this document
    </h1>
  </metal:block>
  <metal:block fill-slot="main">
    <metal:block use-macro="here/cpsgeo_selector/macros/map_selector" />
    <table>
	<tr>
	  <td valign="top" style="padding:10px">
	    <div><div id="locatorMap"/></div>
	    <div><div id="legend"/></div>
	  </td>
	  <td valign="top"> 
	    <table width="100%">
	      <tr>
		<td align="center" valign="top"> <table>
		  <tr>
		    <td colspan="3"> <div id="mainMapPane"/>
		    <div id="loading">
		      <p i18n:translate="label_cpsgeo_loading_program">Loading Program<br/>
		      <img tal:attributes="src string:mapbuilder/lib/skin/default/images/Loading.gif"/>
		      </p>
		    </div>
		    </td>
		  </tr>
		  <tr>
		    <td align="left"> <div id="mainButtonBar"/></td>
		    <td align="center" id="mapScaleText" />&nbsp;
		    <td align="right" id="cursorTrack" />&nbsp;
		  </tr>
		  <tr>
		    <td colspan="3">
		      <h3 i18n:translate="label_cpsgeo_document_location">
			Document Location
		      </h3>
		      <form id="doc_location" action="."
			    tal:attributes="action here/absolute_url">
			<div class="field">
			  <div class="label">
			    <span i18n:translate="label_cpsgeo_coordinates">
			      WGS84 Coordinates
			    </span>
			  </div>
			  <div class="row">
			    <span id="docLocation" />
			  </div>
			</div>
			<div align="left">
			  <input type="submit" name="cps_geolocate:method" 
				 value="button_cpsgeo_set_location" 
				 class="standalone"
				 i18n:attributes="value"
				 onclick="submit_location();"/>
			</div>
		      </form>
		    </td>
		  </tr>
		</table>
		</td>
	      </tr>
	    </table>
	  </td>
	</tr>
    </table>
  </metal:block>
</metal:block>
