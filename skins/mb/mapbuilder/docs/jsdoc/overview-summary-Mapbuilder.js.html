<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<html>
<head>
<title>
<a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 10 Aug 2005 Overview
</title>
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script>
function asd() {
	
		parent.document.title="Mapbuilder.js Overview";
	
}
</script>
</head>
<body bgcolor="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> 	<font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top">
<em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 10 Aug 2005</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<center>
	
	   <h2>Mapbuilder.js</h2>
	
</center>

	


<h4>Summary</h4>
<p>
	
		No overview generated for 'Mapbuilder.js'<BR/><BR/>
	
</p>

<hr>


    <table border="1" cellpadding="3" cellspacing="0" width="100%">
    <tr bgcolor="#CCCCFF" class="TableHeadingColor">
    <td colspan=2><font size="+2">
    
        <b>Class Summary</b>
    
    </font></td>
    </tr>
    
    <tr bgcolor="white" class="TableRowColor">
    <td width="15%"><b><a href="Mapbuilder.html">Mapbuilder</a></b></td>
    <td>&nbsp;</td>
    </tr>
    
    </table>
    <hr/> 


<!-- ========== METHOD SUMMARY =========== -->

	<a name="method_summary"><!-- --></a>
	<table border="1" cellpadding="3" cellspacing="0" width="100%">
		<tr bgcolor="#CCCCFF" class="TableHeadingColor">
			<td colspan=2>
				<font size="+2">
					<b>Method Summary</b>
				</font>
			</td>
		</tr>
	
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#checkIESecurity">checkIESecurity</a></b>()
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 copied from sarissa, a function to check browser security setting in IE, 
 opens a help page if ActiveX objects are disabled.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#mapbuilderInit">mapbuilderInit</a></b>()
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Initialise Mapbuilder if script has been loaded, else wait to be called
 again.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#mbDoLoad">mbDoLoad</a></b>(initFunction)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Mapbuilder's main initialisation script.
		      </td>
		   </tr>
		
	
	</table>
    <p>

<!-- ========== END METHOD SUMMARY =========== -->


        <pre class="sourceview"><span class="comment">/*
License: LGPL as per: http://www.gnu.org/copyleft/lesser.html
$Id$
*/</span>

<span class="comment">/** get a time stamp at start of the page load */</span>
var mbTimerStart = new Date();

<span class="comment">/** the global config object */</span>
var config;

<span class="comment">/** URL of Mapbuilder's lib/ directory. */</span>
var baseDir;

<span class="comment">/** mapbuilder environement settings, defaults to a .xml extension but is 
  auto-configured by the ant build script to .jsp for tomcat environment 
  the URL to this file will be pre-pended with the baseDir value.
*/</span>
var mbServerConfig = <span class="literal">"mapbuilderConfig.xml"</span>;
var mbNsUrl = <span class="literal">"http://mapbuilder.sourceforge.net/mapbuilder"</span>;
<span class="comment">
// LoadState Constants</span>
var MB_UNLOADED=0;    // Scripts not loaded yet
var MB_LOAD_CORE=1;   // Loading scripts loaded defined in Mapbuilder
var MB_LOAD_CONFIG=2; // Loading scripts loaded defined in Config
var MB_LOADED=3;      // All scripts loaded

<span class="comment">/**
 * This Object bootstraps the Mapbuilder libraries by loading the core
 * script files.
 * When Config.js is loaded, the script files for objects described in the
 * Mapbuilder config file are loaded.
 * Objects which have dependencies will trigger the dependancies to load
 * when they are loaded.
 *
 * <span class="attrib">@constructor</span>
 * <span class="attrib">@author</span> Cameron Shorter
 * <span class="attrib">@requires</span> Config
 * <span class="attrib">@requires</span> Listener
 * <span class="attrib">@requires</span> ModelBase
 * <span class="attrib">@requires</span> Sarissa
 * <span class="attrib">@requires</span> Util
 */</span>
<span class="reserved">function</span> Mapbuilder() {

  <span class="comment">/**
   * Determines which Mapbuilder scripts are loading.
   * TBD: Is it possible to use enumerated types in JS?
   */</span>
  <span class="reserved">this</span>.loadState=MB_UNLOADED;

  <span class="comment">/** Array of objects that are loading.  Don't continue initialisation until
   * all objects have loaded. */</span>
  <span class="reserved">this</span>.loadingScripts=new Array();

  <span class="comment">/** Timer to periodically check if scripts have loaded. */</span>
  <span class="reserved">this</span>.scriptsTimer=null;

  <span class="comment">/**
   * Called periodically and moves onto the next loadState when this round of
   * scripts have loaded.
   * For IE clients, object.readyState is used to check if scripts are loaded.
   * Mozilla works fine without this function - I think it is single threaded.
   */</span>
  <span class="reserved">this</span>.checkScriptsLoaded=<span class="reserved">function</span>() {
    <span class="reserved">if</span> (document.readyState!=null){
<span class="comment">      // IE client</span>
<span class="comment">
      // Scripts are removed from array when they have loaded</span>
      <span class="reserved">while</span>(<span class="reserved">this</span>.loadingScripts.length&gt;0
        &amp;&amp;(<span class="reserved">this</span>.loadingScripts[0].readyState==<span class="literal">"loaded"</span>
          ||<span class="reserved">this</span>.loadingScripts[0].readyState==<span class="literal">"complete"</span>
          ||<span class="reserved">this</span>.loadingScripts[0].readyState==null))
      {
        <span class="reserved">this</span>.loadingScripts.shift();
      }
      <span class="reserved">if</span> (<span class="reserved">this</span>.loadingScripts.length==0){
        <span class="reserved">this</span>.setLoadState(<span class="reserved">this</span>.loadState+1);
      }
    }
    <span class="reserved">else</span>{
<span class="comment">      // Mozilla client</span>
      <span class="reserved">if</span>(<span class="reserved">this</span>.loadState==MB_LOAD_CORE &amp;&amp; config!=null){
<span class="comment">        // Config has finished loading</span>
        <span class="reserved">this</span>.setLoadState(MB_LOAD_CONFIG);
      }
    }
  }

  <span class="comment">/**
   * Move onto loading the next set of scripts.
   * <span class="attrib">@param</span> newState The new loading state.
   */</span>
  <span class="reserved">this</span>.setLoadState=<span class="reserved">function</span>(newState){
    <span class="reserved">this</span>.loadState=newState;
    switch (newState){
      case MB_LOAD_CORE:
        <span class="reserved">this</span>.loadScript(baseDir+<span class="literal">"/util/sarissa/Sarissa.js"</span>);
<span class="comment">        //this.loadScript(baseDir+"/util/sarissa/sarissa_dhtml.js");</span>
        <span class="reserved">this</span>.loadScript(baseDir+<span class="literal">"/util/sarissa/sarissa_ieemu_xpath.js"</span>);
<span class="comment">        //this.loadScript(baseDir+"/util/sarissa/sarissa_ieemu_xslt.js");//all deprecated</span>
        <span class="reserved">this</span>.loadScript(baseDir+<span class="literal">"/util/Util.js"</span>);
        <span class="reserved">this</span>.loadScript(baseDir+<span class="literal">"/util/Listener.js"</span>);
        <span class="reserved">this</span>.loadScript(baseDir+<span class="literal">"/model/ModelBase.js"</span>);
        <span class="reserved">this</span>.loadScript(baseDir+<span class="literal">"/model/Config.js"</span>);
        break;
      case MB_LOAD_CONFIG:
        <span class="reserved">if</span>(document.readyState){
<span class="comment">          // IE</span>
          config=new Config(mbConfigUrl);
          config.loadConfigScripts();
        }<span class="reserved">else</span>{
<span class="comment">          // Mozilla</span>
          <span class="reserved">this</span>.setLoadState(MB_LOADED);
        }
        break;
      case MB_LOADED:
        clearInterval(<span class="reserved">this</span>.scriptsTimer);
        break;
    }
  }

  <span class="comment">/**
   * Dynamically load a script file if it has not already been loaded.
   * <span class="attrib">@param</span> url The url of the script.
   */</span>
  <span class="reserved">this</span>.loadScript=<span class="reserved">function</span>(url){
    <span class="reserved">if</span>(!document.getElementById(url)){
      var script = document.createElement(<span class="literal">'script'</span>);
      script.defer = false;   //not sure of effect of <span class="reserved">this</span>?
      script.type = <span class="literal">"text/javascript"</span>;
      script.src = url;
      script.id = url;
      document.getElementsByTagName(<span class="literal">'head'</span>)[0].appendChild(script);
      <span class="reserved">this</span>.loadingScripts.push(script);
    }
  }

  <span class="comment">/**
   * Internal function to load scripts for components that don't have &lt;scriptfile&gt;
   * specified in the config file.
   * <span class="attrib">@param</span> xPath Xpath match of components from the Config file.
   * <span class="attrib">@param</span> dir The directory the script is located in.
   */</span>
  <span class="reserved">this</span>.loadScriptsFromXpath=<span class="reserved">function</span>(nodes,dir) {
<span class="comment">    //var nodes = this.doc.selectNodes(xPath);</span>
    <span class="reserved">for</span> (var i=0; i&lt;nodes.length; i++) {
      <span class="reserved">if</span> (nodes[i].selectSingleNode(<span class="literal">"mb:scriptFile"</span>)==null){
        scriptFile = baseDir+<span class="literal">"/"</span>+dir+nodes[i].nodeName+<span class="literal">".js"</span>;
        <span class="reserved">this</span>.loadScript(scriptFile);
      }
    }
  }
<span class="comment">
  //derive the baseDir value by looking for the script tag that loaded this file</span>
  var head = document.getElementsByTagName(<span class="literal">'head'</span>)[0];
  var nodes = head.childNodes;
  <span class="reserved">for</span> (var i=0; i&lt;nodes.length; ++i ){
    var src = nodes.item(i).src;
    <span class="reserved">if</span> (src) {
      var index = src.indexOf(<span class="literal">"/Mapbuilder.js"</span>);
      <span class="reserved">if</span> (index&gt;=0) {
        baseDir = src.substring(0, index);
      }
    }
  }
<span class="comment">
  // Start loading core scripts.</span>
  <span class="reserved">this</span>.setLoadState(MB_LOAD_CORE);
<span class="comment">
  // Start a timer which periodically calls checkScriptsLoaded().</span>
  <span class="reserved">this</span>.scriptsTimer=setInterval(<span class="literal">'mapbuilder.checkScriptsLoaded()'</span>,100);
}

<span class="comment">/**
 * copied from sarissa, a function to check browser security setting in IE, 
 * opens a help page if ActiveX objects are disabled.
 */</span>
<span class="reserved">function</span> checkIESecurity()
{
  var testPrefixes = [<span class="literal">"Msxml2.DOMDocument.5.0"</span>, <span class="literal">"Msxml2.DOMDocument.4.0"</span>, <span class="literal">"Msxml2.DOMDocument.3.0"</span>, <span class="literal">"MSXML2.DOMDocument"</span>, <span class="literal">"MSXML.DOMDocument"</span>, <span class="literal">"Microsoft.XMLDOM"</span>];
<span class="comment">  // found progID flag</span>
  var bFound = false;
  <span class="reserved">for</span>(var i=0; i &lt; testPrefixes.length &amp;&amp; !bFound; i++) {
    try {
      var oDoc = new ActiveXObject(testPrefixes[i]);
      bFound = true;
    }
    catch (e) {
<span class="comment">      //trap; try next progID</span>
    }
  }
  <span class="reserved">if</span> (!bFound) window.open(<span class="literal">"/mapbuilder/docs/help/IESetup.html"</span>);  //TBD: set <span class="reserved">this</span> URL in config
}

<span class="reserved">if</span> (navigator.userAgent.toLowerCase().indexOf(<span class="literal">"msie"</span>) &gt; -1) checkIESecurity();
var mapbuilder=new Mapbuilder();

<span class="comment">/**
 * Initialise Mapbuilder if script has been loaded, else wait to be called
 * again.
 */</span>
<span class="reserved">function</span> mapbuilderInit(){
  <span class="reserved">if</span>(mapbuilder &amp;&amp; mapbuilder.loadState==MB_LOADED){
    clearInterval(mbTimerId);
    config.init(config);
    config.callListeners(<span class="literal">"init"</span>);
    var mbTimerStop = new Date();
<span class="comment">    //alert("load time:"+(mbTimerStop.getTime()-mbTimerStart.getTime()) );</span>
    <span class="reserved">if</span> (window.mbInit) window.mbInit();
    config.callListeners(<span class="literal">"loadModel"</span>);
  }
}

<span class="comment">/** Timer used when checking if scripts have loaded. */</span>
var mbTimerId;

<span class="comment">/**
 * Mapbuilder's main initialisation script.
 * This should be called from the main html file using:
 *   &lt;body onload="mbDoLoad()"&gt;
 * <span class="attrib">@param</span> initFunction Optional - A function reference that will be called after 
 * config.init() has been called.  This is to give application code a chance to
 * do initialization and be guaranteed that all objects exist (inlcuding config).
 */</span>
<span class="reserved">function</span> mbDoLoad(initFunction) {
<span class="comment">  // See if scripts have been loaded every 100msecs, then call config.init().</span>
  mbTimerId=setInterval(<span class="literal">'mapbuilderInit()'</span>,100);
  <span class="reserved">if</span> (initFunction) window.mbInit = initFunction;
}
</pre>
	<hr>



<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> <font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top"><em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 10 Aug 2005</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<font size="-1">

</font>
<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoc.sourceforge.net/" target="_parent">JSDoc</a> on Wed Aug 10 14:31:26 2005</div>
</body>
</html>
