<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<html>
<head>
<title>
<a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 10 Aug 2005 Overview
</title>
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script>
function asd() {
	
		parent.document.title="Proj.js Overview";
	
}
</script>
</head>
<body bgcolor="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> 	<font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top">
<em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 10 Aug 2005</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<center>
	
	   <h2>Proj.js</h2>
	
</center>

	


<h4>Summary</h4>
<p>
	
		No overview generated for 'Proj.js'<BR/><BR/>
	
</p>

<hr>


    <table border="1" cellpadding="3" cellspacing="0" width="100%">
    <tr bgcolor="#CCCCFF" class="TableHeadingColor">
    <td colspan=2><font size="+2">
    
        <b>Class Summary</b>
    
    </font></td>
    </tr>
    
    <tr bgcolor="white" class="TableRowColor">
    <td width="15%"><b><a href="Proj.html">Proj</a></b></td>
    <td>&nbsp;</td>
    </tr>
    
    </table>
    <hr/> 


<!-- ========== METHOD SUMMARY =========== -->

	<a name="method_summary"><!-- --></a>
	<table border="1" cellpadding="3" cellspacing="0" width="100%">
		<tr bgcolor="#CCCCFF" class="TableHeadingColor">
			<td colspan=2>
				<font size="+2">
					<b>Method Summary</b>
				</font>
			</td>
		</tr>
	
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#adjust_lon">adjust_lon</a></b>(x)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#bilinterp">bilinterp</a></b>(x, y, a, b, c, d)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Bilinear interpolation function to return an interpolated value for either
 x or y for some point located within a box where the XY of the corners are known.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#lcc2ll">lcc2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2lcc">ll2lcc</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2pixel">ll2pixel</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#ll2scene">ll2scene</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Scene projection forward transformation.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#msfnz">msfnz</a></b>(eccent, sinphi, cosphi)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#phi2z">phi2z</a></b>(eccent, ts)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#pixel2ll">pixel2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#scene2ll">scene2ll</a></b>(coords)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Scene projection Inverse transformation.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#sceneInit">sceneInit</a></b>(param)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Scene projection initialization function
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#sign">sign</a></b>(x)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#tsfnz">tsfnz</a></b>(eccent, phi, sinphi)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
	
	</table>
    <p>

<!-- ========== END METHOD SUMMARY =========== -->


        <pre class="sourceview"><span class="comment">/*
Author:       Mike Adair mike.adairATccrs.nrcan.gc.ca
License:      LGPL as per: http://www.gnu.org/copyleft/lesser.html
$Id$
*/</span>

<span class="comment">/**
 * Provides latitude/longitude to map projection (and vice versa) transformation methods. 
 * Initialized with EPSG codes.  Has properties for units and title strings.
 * All coordinates are handled as points which is a 2 element array where x is 
 * the first element and y is the second. 
 * For the Forward() method pass in lat/lon and it returns map XY.
 * For the Inverse() method pass in map XY and it returns lat/long.
 *
 * TBD: retrieve initialization params (and conversion code?) from a web service 
 *
 * <span class="attrib">@constructor</span>
 *
 * <span class="attrib">@param</span> srs         The SRS (EPSG code) of the projection
 */</span>

<span class="reserved">function</span> Proj(srs) {
  <span class="reserved">this</span>.srs = srs.toUpperCase();
  switch(<span class="reserved">this</span>.srs) {
    case <span class="literal">"EPSG:4326"</span>:       //lat/lon projection WGS_84
    case <span class="literal">"EPSG:4269"</span>:       //lat/lon projection WGS_84
    case <span class="literal">"CRS:84"</span>:          //lat/lon projection WGS_84
    case <span class="literal">"EPSG:4965"</span>:       //lat/lon projection RGF93G IGN-F FD 2005
    case new String(<span class="literal">"http://www.opengis.net/gml/srs/epsg.xml#4326"</span>).toUpperCase():
      <span class="reserved">this</span>.Forward = identity;
      <span class="reserved">this</span>.Inverse = identity;
      <span class="reserved">this</span>.units = <span class="literal">"degrees"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lat/Long"</span>;
      break;
    case <span class="literal">"EPSG:42101"</span>:        //North American LCC WGS_84
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0,6356752.314245,49.0,77.0,-95.0, 0.0, 0.0, -8000000));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:42304"</span>:        //North American LCC NAD_83
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0,6356752.314,49.0,77.0,-95.0, 49.0, 0.0, 0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:26986"</span>:        //NAD83 / Massachusetts Mainland
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0,6356752.314,42.68333333333333,41.71666666666667,-71.5, 41.0, 200000, 750000));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Massachusetts Mainland (LCC)"</span>;
      break;
    case <span class="literal">"EPSG:32761"</span>:        //Polar Stereographic
    case <span class="literal">"EPSG:32661"</span>:
      <span class="reserved">this</span>.Init = psinit;
      <span class="reserved">this</span>.Forward = ll2ps;
      <span class="reserved">this</span>.Inverse = ps2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0, 6356752.314245, 0.0, -90.0, 2000000, 2000000));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Polar Stereographic"</span>;
      break;
    case <span class="literal">"EPSG:27561"</span>://LAMB1 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 49.50, 49.50, 2.33722916655, 49.50, 600000.0, 200000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:27562"</span>://LAMB2 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 46.80, 46.80, 2.33722916655, 46.8, 600000.0, 200000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:27572"</span>://LAMBE IGN-F modification FD 2005
    case <span class="literal">"EPSG:27582"</span>://LAMB2 IGN-F modification (deprecated) FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 46.80, 46.80, 2.33722916655, 46.8, 600000.0, 2200000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:27563"</span>://LAMB3 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 44.10, 44.10, 2.33722916655, 44.10, 600000.0, 200000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:27564"</span>://LAMB4 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378249.2, 6356515.0, 42.17, 42.17, 2.33722916655, 42.17, 234.358, 185861.369));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"EPSG:2154"</span> ://LAMB93 IGN-F modification FD 2005
      <span class="reserved">this</span>.Init = lccinit;
      <span class="reserved">this</span>.Forward = ll2lcc;
      <span class="reserved">this</span>.Inverse = lcc2ll;
      <span class="reserved">this</span>.Init(new Array(6378137.0, 6356752.3141, 44.00, 49.00, 3.00000000001, 46.50, 700000.0, 6600000.0));
      <span class="reserved">this</span>.units = <span class="literal">"meters"</span>;
      <span class="reserved">this</span>.title = <span class="literal">"Lambert Conformal Conic"</span>;
      break;
    case <span class="literal">"SCENE"</span>:             //<span class="reserved">this</span> is really a pixel projection with bilinear interpolation of the corners to get ll
      <span class="reserved">this</span>.Init = sceneInit;
      <span class="reserved">this</span>.Forward = ll2scene;
      <span class="reserved">this</span>.Inverse = scene2ll;
      <span class="reserved">this</span>.GetXYCoords = identity;  //override to get line 0 at top left
      <span class="reserved">this</span>.GetPLCoords = identity; //
      break;
    case <span class="literal">"PIXEL"</span>:
      <span class="reserved">this</span>.Forward = ll2pixel;
      <span class="reserved">this</span>.Inverse = pixel2ll;
      <span class="reserved">this</span>.units = <span class="literal">"pixels"</span>;
      <span class="reserved">this</span>.GetXYCoords = identity;  //override to get line 0 at top left
      <span class="reserved">this</span>.GetPLCoords = identity; //
      break;
    default:
<span class="comment">      //or retrieve parameters from web service based on SRS lookup</span>
      alert(<span class="literal">"unsupported map projection: "</span>+<span class="reserved">this</span>.srs);
  }

  <span class="reserved">this</span>.matchSrs = <span class="reserved">function</span>(otherSrs) {
    <span class="reserved">if</span> (<span class="reserved">this</span>.srs == otherSrs.toUpperCase() ) <span class="reserved">return</span> true;
    <span class="reserved">return</span> false;
  }

}

<span class="reserved">function</span> identity(coords) {
  <span class="reserved">return</span> coords;
}

<span class="comment">/**
 * Scene projection forward transformation.
 * Forward trasnformation need reverse bilinear interpolation or orbit modelling 
 * (to be implemented)
 * <span class="attrib">@param</span> coords  Lat/Long coords passed in
 * <span class="attrib">@return</span> map coordinates
 */</span>
<span class="reserved">function</span> ll2scene(coords) {
  alert(<span class="literal">"ll2scene not defined"</span>);
<span class="comment">  //return new Array(124, 15+256);  //for testing only, </span>
  <span class="reserved">return</span> null;
}

<span class="comment">/**
 * Scene projection Inverse transformation.
 * This is really a pixel representation with bi-linear interpolation of the corner coords.
 * <span class="attrib">@param</span> coords  map coordinates passed in
 * <span class="attrib">@return</span> Lat/Long coords 
 */</span>
<span class="reserved">function</span> scene2ll(coords) {
  var xpct = (coords[0]-<span class="reserved">this</span>.ul[0])/(<span class="reserved">this</span>.lr[0]-<span class="reserved">this</span>.ul[0]);
  var ypct = (coords[1]-<span class="reserved">this</span>.ul[1])/(<span class="reserved">this</span>.lr[1]-<span class="reserved">this</span>.ul[1]);
<span class="comment">//  alert("pct:"+xpct+":"+ypct);</span>
  var lon = bilinterp(xpct, ypct, <span class="reserved">this</span>.cul[0], <span class="reserved">this</span>.cur[0], <span class="reserved">this</span>.cll[0], <span class="reserved">this</span>.clr[0])
  var lat = bilinterp(xpct, ypct, <span class="reserved">this</span>.cul[1], <span class="reserved">this</span>.cur[1], <span class="reserved">this</span>.cll[1], <span class="reserved">this</span>.clr[1])
  <span class="reserved">return</span> new Array(lon, lat);
}

<span class="comment">/**
 * Scene projection initialization function
 * <span class="attrib">@param</span> param  array of the corner coordinates (which are in turn 2D point arrays)
 * in the order upper-left, upper-right, lower-left, lower-right
 */</span>
<span class="reserved">function</span> sceneInit(param) {
  <span class="reserved">this</span>.cul = param[0];
  <span class="reserved">this</span>.cur = param[1];
  <span class="reserved">this</span>.cll = param[2];
  <span class="reserved">this</span>.clr = param[3];
}

<span class="comment">/**
 * Bilinear interpolation function to return an interpolated value for either
 * x or y for some point located within a box where the XY of the corners are known.
 * This should be applied to the x and y coordinates separately, 
 * ie. first interpolate for the x value, then the y.
 * the a,b,c,d params are thus the x or y values at the corners.
 * <span class="attrib">@param</span> x distance from the left side of the box as a percentage
 * <span class="attrib">@param</span> y distance from the top of the box as a percentage
 * <span class="attrib">@param</span> a either x or y value at the UL corner of the box
 * <span class="attrib">@param</span> b either x or y value at the UR corner of the box
 * <span class="attrib">@param</span> c either x or y value at the LL corner of the box
 * <span class="attrib">@param</span> d either x or y value at the LR corner of the box
 */</span>
<span class="reserved">function</span> bilinterp(x, y, a, b, c, d) {
  var top = x*(b-a) + a;
  var bot = x*(d-c) + c;
<span class="comment">//alert("top:"+top+"  bot:"+bot);</span>
  <span class="reserved">return</span> y*(bot-top) + top;
}
<span class="comment">
// pixel projection object definition</span>
<span class="comment">// a pixel representation </span>
<span class="comment">// forward transformation</span>
<span class="reserved">function</span> ll2pixel(coords) {
  alert(<span class="literal">"ll2pixel not defined"</span>);
  <span class="reserved">return</span> null;
}
<span class="comment">
// inverse transformation</span>
<span class="reserved">function</span> pixel2ll(coords) {
  alert(<span class="literal">"pixel2ll not defined"</span>);
<span class="comment">//  return new Array(lon, lat);</span>
  <span class="reserved">return</span> null;
}


<span class="comment">/****************************************************************************
The following code is a direct port of PROJ4 coordinate transformation code
from C to Javascript.  For more information go to http://proj.maptools.org/
Currently suppported projections include: Lambert Conformal Conic (LCC), 
Lat/Long, Polar Stereographic.
Porting C to Javascript is fairly straightforward so other support for more 
projections is easy to add.
*/</span>

var PI = Math.PI;
var HALF_PI = PI*0.5;
var TWO_PI = PI*2.0;
var EPSLN = 1.0e-10;
var R2D = 57.2957795131;
var D2R =0.0174532925199;
var R = 6370997.0;        // Radius of the earth (sphere)
<span class="comment">

// Initialize the Lambert Conformal conic projection</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> lccinit(param) {
<span class="comment">// array of:  r_maj,r_min,lat1,lat2,c_lon,c_lat,false_east,false_north</span>
<span class="comment">//double c_lat;                   /* center latitude                      */</span>
<span class="comment">//double c_lon;                   /* center longitude                     */</span>
<span class="comment">//double lat1;                    /* first standard parallel              */</span>
<span class="comment">//double lat2;                    /* second standard parallel             */</span>
<span class="comment">//double r_maj;                   /* major axis                           */</span>
<span class="comment">//double r_min;                   /* minor axis                           */</span>
<span class="comment">//double false_east;              /* x offset in meters                   */</span>
<span class="comment">//double false_north;             /* y offset in meters                   */</span>

  <span class="reserved">this</span>.r_major = param[0];
  <span class="reserved">this</span>.r_minor = param[1];
  var lat1 = param[2] * D2R;
  var lat2 = param[3] * D2R;
  <span class="reserved">this</span>.center_lon = param[4] * D2R;
  <span class="reserved">this</span>.center_lat = param[5] * D2R;
  <span class="reserved">this</span>.false_easting = param[6];
  <span class="reserved">this</span>.false_northing = param[7];
<span class="comment">
// Standard Parallels cannot be equal and on opposite sides of the equator</span>
  <span class="reserved">if</span> (Math.abs(lat1+lat2) &lt; EPSLN) {
    alert(<span class="literal">"Equal Latitiudes for St. Parallels on opposite sides of equator - lccinit"</span>);
    <span class="reserved">return</span>;
  }

  var temp = <span class="reserved">this</span>.r_minor / <span class="reserved">this</span>.r_major;
  <span class="reserved">this</span>.e = Math.sqrt(1.0 - temp*temp);

  var sin1 = Math.sin(lat1);
  var cos1 = Math.cos(lat1);
  var ms1 = msfnz(<span class="reserved">this</span>.e, sin1, cos1);
  var ts1 = tsfnz(<span class="reserved">this</span>.e, lat1, sin1);
  
  var sin2 = Math.sin(lat2);
  var cos2 = Math.cos(lat2);
  var ms2 = msfnz(<span class="reserved">this</span>.e, sin2, cos2);
  var ts2 = tsfnz(<span class="reserved">this</span>.e, lat2, sin2);
  
  var ts0 = tsfnz(<span class="reserved">this</span>.e, <span class="reserved">this</span>.center_lat, Math.sin(<span class="reserved">this</span>.center_lat));

  <span class="reserved">if</span> (Math.abs(lat1 - lat2) &gt; EPSLN) {
    <span class="reserved">this</span>.ns = Math.log(ms1/ms2)/Math.log(ts1/ts2);
  } <span class="reserved">else</span> {
    <span class="reserved">this</span>.ns = sin1;
  }
  <span class="reserved">this</span>.f0 = ms1 / (<span class="reserved">this</span>.ns * Math.pow(ts1, <span class="reserved">this</span>.ns));
  <span class="reserved">this</span>.rh = <span class="reserved">this</span>.r_major * <span class="reserved">this</span>.f0 * Math.pow(ts0, <span class="reserved">this</span>.ns);
}
<span class="comment">

// Lambert Conformal conic forward equations--mapping lat,long to x,y</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> ll2lcc(coords) {

  var lon = coords[0];
  var lat = coords[1];
<span class="comment">
// convert to radians</span>
  <span class="reserved">if</span> ( lat &lt;= 90.0 &amp;&amp; lat &gt;= -90.0 &amp;&amp; lon &lt;= 180.0 &amp;&amp; lon &gt;= -180.0) {
    lat *= D2R;
    lon *= D2R;
  } <span class="reserved">else</span> {
    alert(<span class="literal">"*** Input out of range ***: lon: "</span>+lon+<span class="literal">" - lat: "</span>+lat);
    <span class="reserved">return</span> null;
  }

  var con  = Math.abs( Math.abs(lat) - HALF_PI);
  var ts;
  <span class="reserved">if</span> (con &gt; EPSLN) {
    ts = tsfnz(<span class="reserved">this</span>.e, lat, Math.sin(lat) );
    rh1 = <span class="reserved">this</span>.r_major * <span class="reserved">this</span>.f0 * Math.pow(ts, <span class="reserved">this</span>.ns);
  } <span class="reserved">else</span> {
    con = lat * <span class="reserved">this</span>.ns;
    <span class="reserved">if</span> (con &lt;= 0) {
      alert(<span class="literal">"Point can not be projected - ll2lcc"</span>);
      <span class="reserved">return</span> null;
    }
    rh1 = 0;
  }
  var theta = <span class="reserved">this</span>.ns * adjust_lon(lon - <span class="reserved">this</span>.center_lon);
  var x = rh1 * Math.sin(theta) + <span class="reserved">this</span>.false_easting;
  var y = <span class="reserved">this</span>.rh - rh1 * Math.cos(theta) + <span class="reserved">this</span>.false_northing;

  <span class="reserved">return</span> new Array(x,y);
}
<span class="comment">
// Lambert Conformal Conic inverse equations--mapping x,y to lat/long</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> lcc2ll(coords) {

  var rh1, con, ts;
  var lat, lon;
  x = coords[0] - <span class="reserved">this</span>.false_easting;
  y = <span class="reserved">this</span>.rh - coords[1] + <span class="reserved">this</span>.false_northing;
  <span class="reserved">if</span> (<span class="reserved">this</span>.ns &gt; 0) {
    rh1 = Math.sqrt (x * x + y * y);
    con = 1.0;
  } <span class="reserved">else</span> {
    rh1 = -Math.sqrt (x * x + y * y);
    con = -1.0;
  }
  var theta = 0.0;
  <span class="reserved">if</span> (rh1 != 0) {
    theta = Math.atan2((con * x),(con * y));
  }
  <span class="reserved">if</span> ((rh1 != 0) || (<span class="reserved">this</span>.ns &gt; 0.0)) {
    con = 1.0/<span class="reserved">this</span>.ns;
    ts = Math.pow((rh1/(<span class="reserved">this</span>.r_major * <span class="reserved">this</span>.f0)), con);
    lat = phi2z(<span class="reserved">this</span>.e, ts);
    <span class="reserved">if</span> (lat == -9999) <span class="reserved">return</span> null;
  } <span class="reserved">else</span> {
    lat = -HALF_PI;
  }
  lon = adjust_lon(theta/<span class="reserved">this</span>.ns + <span class="reserved">this</span>.center_lon);
  <span class="reserved">return</span> new Array(R2D*lon, R2D*lat);
}
<span class="comment">
// Function to compute the constant small m which is the radius of</span>
<span class="comment">//   a parallel of latitude, phi, divided by the semimajor axis.</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> msfnz(eccent, sinphi, cosphi) {
      var con = eccent * sinphi;
      <span class="reserved">return</span> cosphi/(Math.sqrt(1.0 - con * con));
}
<span class="comment">
// Function to compute the constant small t for use in the forward</span>
<span class="comment">//   computations in the Lambert Conformal Conic and the Polar</span>
<span class="comment">//   Stereographic projections.</span>
<span class="comment">// -----------------------------------------------------------------</span>
<span class="reserved">function</span> tsfnz(eccent, phi, sinphi) {
  var con = eccent * sinphi;
  var com = .5 * eccent; 
  con = Math.pow(((1.0 - con) / (1.0 + con)), com);
  <span class="reserved">return</span> (Math.tan(.5 * (HALF_PI - phi))/con);
}
<span class="comment">

// Function to compute the latitude angle, phi2, for the inverse of the</span>
<span class="comment">//   Lambert Conformal Conic and Polar Stereographic projections.</span>
<span class="comment">// ----------------------------------------------------------------</span>
<span class="reserved">function</span> phi2z(eccent, ts) {
  var eccnth = .5 * eccent;
  var con, dphi;
  var phi = HALF_PI - 2 * Math.atan(ts);
  <span class="reserved">for</span> (i = 0; i &lt;= 15; i++) {
    con = eccent * Math.sin(phi);
    dphi = HALF_PI - 2 * Math.atan(ts *(Math.pow(((1.0 - con)/(1.0 + con)),eccnth))) - phi;
    phi += dphi; 
    <span class="reserved">if</span> (Math.abs(dphi) &lt;= .0000000001) <span class="reserved">return</span> phi;
  }
  alert(<span class="literal">"Convergence error - phi2z"</span>);
  <span class="reserved">return</span> -9999;
}
<span class="comment">
// Function to return the sign of an argument</span>
<span class="reserved">function</span> sign(x) { <span class="reserved">if</span> (x &lt; 0.0) <span class="reserved">return</span>(-1); <span class="reserved">else</span> <span class="reserved">return</span>(1);}
<span class="comment">
// Function to adjust longitude to -180 to 180; input in radians</span>
<span class="reserved">function</span> adjust_lon(x) {x=(Math.abs(x)&lt;PI)?x:(x-(sign(x)*TWO_PI));<span class="reserved">return</span>(x);}


</pre>
	<hr>



<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> <font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top"><em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 10 Aug 2005</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<font size="-1">

</font>
<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoc.sourceforge.net/" target="_parent">JSDoc</a> on Wed Aug 10 14:31:26 2005</div>
</body>
</html>
